# user-api-demo

## Install

Clone the repository and run `composer install`

Then create the database and migrate the schema
```
php bin/console doctrine:database:create
php bin/console doctrine:migrations:diff
php bin/console doctrine:migrations:migrate
```
The API requires an admin user to make most of the requests, which can be added manually through, for example, SQLiteStudio. 
Note:
  - the id should be an int >= 0
  - the email field should be a valid email *(e.g. test@test.com)*
  - the roles should be a valid json string *(e.g. ["ROLE_ADMIN"])* 
  - the password field requires a hashed string, which can be generated by running `php bin/console security:hash-password`

Now you're free to try out the application locally with `symfony serve`

## Authentication

Every request (except **PATCH**) requires the *Email* and *X-AUTH-TOKEN* headers. The email should be from a user with the admin role and the token can be generated by making a **GET** request to `~/api/keygen`. 

This authentication request requires both an *Email* and *Password* header with an admin user's credentials.

## Requests

Requests can be made to the `~/api/users` and `~/api/users-collection` paths.

The former supports: **GET, POST, PUT, PATCH** and **DELETE**.
The latter only supports **POST**.

The content of these requests should be explicitly *application/json* in the content type header. They also require the email and auth-token headers described previously, with the exception of **PATCH** requests, which can be made by any user and require his email and password credentials in the respective headers.

## Examples

All of the endpoints were tested with the browser extension [RESTED](https://github.com/RESTEDClient/RESTED).

### GET request to `~/api/keygen`

![Example of get request to /api/keygen endpoint](/assets/examples/get.keygen.PNG)
